---
layout: doc
title: Deploy FusionAuth in a Kubernetes Cluster
description: Deploy FusionAuth in a Kubernetes Cluster
keywords: docker kubernetes k8s container aws
---
Kubernetes is an extensible and open-source container-orchestration system used for automating application deployments. Some of the most notable features it provides include self-healing, auto-scaling, and automated rollouts and rollbacks.

Since the Kubernetes container runtime supports link:../docker[Docker], FusionAuth link:../docker[Docker] containers can be deployed to any Kubernetes cluster.

The following guide demonstrates how to deploy FusionAuth containers using link:https://kubernetes.io/docs/tasks/tools/[kubectl], the Kubernetes command-line tool that enables you to send commands to a cluster through the link:https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/[API server].
Before proceeding, it is required that you have a running Kubernetes cluster and link:https://kubernetes.io/docs/tasks/tools/[kubectl] configured to communicate with that cluster. If you need to setup a cluster, we have provided the following installation guides to get you up and running as fast as possible.

* link:setup/eks[Amazon Elastic Kubernetes Service (EKS)]
* link:setup/aks[Microsoft Azure Kubernetes Service (AKS)]
* link:setup/gke[Google Kubernetes Engine (GKE)]

== Requirements

* `kubectl` - Command line tool that interacts with the Kubernetes API server and is useful for managing Kubernetes clusters. Before proceeding, follow the https://kubernetes.io/docs/tasks/tools/[installation documentation that corresponds to your platform].
We will be using version `1.22` for this guide.
* `helm` - Package manager used for installing and managing Kubernetes applications. In this guide, we will be using a Helm chart to install FusionAuth on our Kubernetes cluster. For more information, see link:https://helm.sh/docs/intro/install/[Installing Helm].
* An available Kubernetes cluster. See guides above.

== Configuration

To get started, the first thing to do is add the FusionAuth Helm Chart repository. This can be done with the following.

```bash
$ helm repo add fusionauth https://fusionauth.github.io/charts
```

To view the list of repos that we have added, use the `helm repo list` command:
```
NAME      	URL
fusionauth	https://fusionauth.github.io/charts
```

To search repos, use the `helm search repo <repo name>` command:
```
$ helm search repo fusionauth

NAME                 	CHART VERSION	APP VERSION	DESCRIPTION
fusionauth/fusionauth	0.10.5       	1.30.1     	Helm chart for fusionauth
```

=== Helm Chart configuration

Before we install, configure the `values.yaml` file contents used by the Helm Chart. The majority of the values for this chart have defaults recommended by FusionAuth but you will want to modify some application specific attributes.

Retrieve a copy of `values.yaml` for the FusionAuth helm chart.

```bash
$ curl -o values.yaml https://raw.githubusercontent.com/FusionAuth/charts/master/chart/values.yaml
```

Open `values.yaml` with your favorite text editor.

==== Replicas

The [field]#replicaCount# value indicates the number of instances of FusionAuth to run in a link:https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/[ReplicaSet].

By default, the [field]#replicaCount# value is set to `1`. This means that when we deploy our application to the cluster, Kubernetes will monitor the cluster to ensure that at least `1` instance of FusionAuth is running at all times.

```yaml
# replicaCount -- The number of fusionauth-app instances to run
replicaCount: 1
```

==== Docker image

The most current helm chart will always point to the latest version of FusionAuth. For this guide, we are on version `1.30.1`.

```yaml
image:
  # image.repository -- The name of the docker repository for fusionauth-app
  repository: fusionauth/fusionauth-app
  # image.repository -- The docker tag to pull for fusionauth-app
  tag: 1.30.1
  # image.pullPolicy -- Kubernetes image pullPolicy to use for fusionauth-app
  pullPolicy: IfNotPresent
```

==== Database Configuration

Now that we have our helm `values.yaml`, the first thing you will want to do is configure the database. Each of our FusionAuth pods will use this configuration when communicating with the database.

```yaml
database:
  # database.protocol -- Should either be postgresql or mysql. Protocol for jdbc connection to database
  protocol: postgresql
  # database.host -- Hostname or ip of the database instance
  host: ""
  # database.host -- Port of the database instance
  port: 5432
  # database.tls -- Configures whether or not to use tls when connecting to the database
  tls: false
  # database.tlsMode -- If tls is enabled, this configures the mode
  tlsMode: require
  # database.name -- Name of the fusionauth database
  name: fusionauth

  # To use an existing secret, set `existingSecret` to the name of the secret. We expect at most two keys: `password` is required. `rootpassword` is only required if `database.root.user` is set.
  # database.existingSecret -- The name of an existing secret that contains the database passwords
  existingSecret: ""
  # database.user -- Database username for fusionauth to use in normal operation
  user: ""
  # database.password -- Database password for fusionauth to use in normal operation - not required if database.existingSecret is configured
  password: ""
  # These credentials are used for bootstrapping the database
  root:
    # database.root.user -- Database username for fusionauth to use during initial bootstrap - not required if you have manually bootstrapped your database
    user: ""
    # database.root.password -- Database password for fusionauth to use during initial bootstrap - not required if database.existingSecret is configured
    password: ""

search:
  # search.engine -- Defines backend for fusionauth search capabilities. Valid values for engine are 'elasticsearch' or 'database'.
  engine: database
```

At this point, the required fields that need to be provided are [field]#host#, [field]#user#, [field]#password#, [field]#root.user#, and [field]#root.password#. It is important to retrieve these attributes when you initially setup your database.
We are also going to set [field]#search.engine# field to `database`.

== Deploy FusionAuth to the cluster

Now that the desired `values.yaml` configuration has been set, its time to install the chart on our cluster. The `helm install` command is used to install a chart by name and can be applied using the syntax:

```
helm install [CHART NAME] [CHART] [flags]
```

Here we will install a chart including the `-f` flag to override the default values.

```bash
$ helm install my-release fusionauth/fusionauth -f values.yaml
```

Alternatively, values can be overridden using the `set` command using key/value pairs.

```bash
$ helm install my-release fusionauth/fusionauth \                                                                                            ✔  4s  brett@fusionauth.io@fusionauth-example.us-west-1.eksctl.io ○
  --set replicaCount=1 \
  --set database.host=fusionauth-eks-example.ceeh9yeyi3hf.us-west-1.rds.amazonaws.com \
  --set database.user=fusionauth \
  --set database.password=hkaLBM3RVnyYeYeqE3WI1w2e4Avpy0Wd5O3s3 \
  --set database.root.user=postgres \
  --set database.root.password=foobarbaz \
  --set search.engine=database \
```

[NOTE.info]
====
Include the flag `--dry-run` if you would like to view the generated template before installing the template.
====

If the previous command was successful, you should see output similar to the following.

```
NAME: my-release
LAST DEPLOYED: Sun Oct 10 19:23:41 2021
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export SVC_NAME=$(kubectl get svc --namespace default -l "app.kubernetes.io/name=fusionauth,app.kubernetes.io/instance=my-release" -o jsonpath="{.items[0].metadata.name}")
  echo "Visit http://127.0.0.1:9011 to use your application"
  kubectl port-forward svc/$SVC_NAME 9011:9011
```

We can also get the status of our deployment by using `kubectl`.

```
$ kubectl get deployments -o wide
...
NAME                    READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS   IMAGES                             SELECTOR
my-release-fusionauth   1/1     1            1           4m16s   fusionauth   fusionauth/fusionauth-app:1.30.1   app.kubernetes.io/instance=my-release,app.kubernetes.io/name=fusionauth
```

Finally, its time to verify our deployment via the browser. As instructed by the output above, we will create a proxy enabling us to connect to the cluster from localhost.

```
Forwarding from 127.0.0.1:9011 -> 9011
```

Navigate to http://localhost:9011

image::installation-guides/kubernetes/fa-success.png[FusionAuth index,width=1200,role=shadowed bottom-cropped]

Congratulations! You have now successfully deployed FusionAuth to a Kubernetes cluster.